<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Assignment 03</title>
        <script src="validation.js">
            // Variables for the number range and the random target number
            var minNum = 1;
            var maxNum = 999;
            var randomValue;

            /**
             * Validates the maximum number input and sets up the guessing stage
             */
            function validateMaxNumber()
            {
                var maxNumber = document.getElementById("maxNumber");
                var error = document.getElementById("error");
                var maxValue = maxNumber.value;
                
                // Check if the max number is within the allowed range
                if((maxValue < 1) || (maxValue > 999))
                {
                    error.innerHTML = "The number <b>must</b> between 1 and 999.";
                    return;
                }
                // Clear any previous error messages
                error.innerHTML = "";
                
                // If we're in the second section, move to the third and set up the game
                if(currentDiv == 2)
                {
                    document.getElementById("section2").style.display = "none";
		            document.getElementById("section3").style.display = "block";
                    currentDiv = 3;

                    maxNum = maxValue;
                    document.getElementById("guessNumberLabel").textContent = currentName + ", guess a number("+minNum+" - "+maxNum+")";
                    maxNumber.value = "";
                    randomValue = Math.floor(Math.random() * maxNum) + minNum;
                }
            }
        
            /**
             * Validates the user's guess and provides feedback or ends the game
             */
            function validateGuessNumber()
            {
                var guessNumber = document.getElementById("guessNumber");
                var error = document.getElementById("error");
                var guessValue = parseInt(guessNumber.value);
                // Check if the guess is within the current range
                if((guessValue < minNum) || (guessValue > maxNum))
                {
                    error.innerHTML = "The number <b>must</b> between " + minNum + " and " + maxNum + ".";
                    return;
                }
                // Clear any previous error messages
                error.innerHTML = "";
                
                // console.log("Guess:" + guessValue + typeof(guessValue));
                // console.log("Random:"+ randomValue + typeof(randomValue));
                
                // Compare the guess to the random value and update the game state
                if (guessValue < randomValue)
                {
                    minNum = guessValue + 1;
                    guessNumber.value = ""
                    document.getElementById("guessNumberLabel").textContent = currentName + ", guess a number(" + minNum + " - "+maxNum+")";
                }
                else if (guessValue > randomValue)
                {
                    maxNum = guessValue - 1;
                    guessNumber.value = ""
                    document.getElementById("guessNumberLabel").textContent = currentName + ", guess a number(" + minNum + " - "+maxNum+")";
                }
                else
                {
                    // Correct guess - end the game
                    document.getElementById("section3").style.display = "none";
		            document.getElementById("section4").style.display = "block";
                    document.body.style.backgroundColor = "green";
                    currentDiv = 4;
                    guessNumber.value = ""
                }
            }

            /**
             * Resets the game state to play again
             */
            function playAgain()
            {
                document.getElementById("section4").style.display = "none";
		        document.getElementById("section2").style.display = "block";
                document.body.style.backgroundColor = "";
                currentDiv = 2;
                minNum = 1;
                maxNum = 999;
            }
        </script>
    </head>
    <body>
        <form id="startForm" action="setMax.asp" method="post">
            <div>
                <label for="userName">User Name:</label>
                <input type="text" id="userName" name="userName"/>
                <button type="button" onclick="
                var [passed, feedback] = validateName(userName.value);
                errorMessage.innerHTML = feedback;
                if(passed) startForm.submit()">Confirm</button>
            </div>
        </form>

        <!-- Error message container -->
        <br>
        <div id="errorMessage" style="color:red;"></div>
    </body>
</html>